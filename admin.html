<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KYC Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Mulish', sans-serif; background: #f4f7f9; padding: 40px; margin: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1 { font-size: 24px; color: #1f2c3d; margin: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; background: #f8f9fa; color: #51596c; padding: 15px; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; vertical-align: middle; }
        .user-img { width: 60px; height: 60px; border-radius: 4px; object-fit: cover; border: 1px solid #ddd; cursor: pointer; }
        .map-btn { background: #e7f3ff; color: #3395ff; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-weight: 700; font-size: 12px; }
        .map-btn:hover { background: #3395ff; color: white; }
        .badge { background: #2ecc71; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; }
    </style>
</head>
<body>

<div class="header">
    <h1>KYC Admin Dashboard</h1>
    <div id="stats" style="color: #666; font-size: 14px;">Connected to Firebase Live</div>
</div>

<div class="container">
    <table>
        <thead>
            <tr>
                <th>Photo</th>
                <th>Submission ID</th>
                <th>Location (Lat/Lon)</th>
                <th>Time Received</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="admin-table">
            </tbody>
    </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
    // USE THE EXACT SAME CONFIG AS YOUR INDEX.HTML
    const firebaseConfig = {
          apiKey: "AIzaSyDiuJzAE0cPsyIFP4AbOhMogCYYMveYWs0",
  authDomain: "management-system-42018.firebaseapp.com",
  databaseURL: "https://management-system-42018-default-rtdb.firebaseio.com",
  projectId: "management-system-42018",
  storageBucket: "management-system-42018.firebasestorage.app",
  messagingSenderId: "54905325970",
  appId: "1:54905325970:web:d904a020fc8ca66fa2d94b"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Listen for new submissions in real-time
    db.collection("kyc_submissions").orderBy("timestamp", "desc")
      .onSnapshot((snapshot) => {
        const table = document.getElementById('admin-table');
        table.innerHTML = ""; // Clear for refresh

        snapshot.forEach((doc) => {
            const data = doc.data();
            const time = data.timestamp ? data.timestamp.toDate().toLocaleString() : "Syncing...";
            
            const row = `
                <tr>
                    <td><a href="${data.photoUrl}" target="_blank"><img src="${data.photoUrl}" class="user-img"></a></td>
                    <td><code style="background:#eee; padding:2px 5px;">${doc.id}</code></td>
                    <td>${data.latitude.toFixed(4)}, ${data.longitude.toFixed(4)}</td>
                    <td>${time}</td>
                    <td><a href="https://www.google.com/maps?q=${data.latitude},${data.longitude}" target="_blank" class="map-btn">VIEW ON MAP</a></td>
                </tr>
            `;
            table.innerHTML += row;
        });
    });
</script>
</body>
</html>